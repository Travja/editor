var le=Object.defineProperty;var ae=(n,e,t)=>e in n?le(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var o=(n,e,t)=>(ae(n,typeof e!="symbol"?e+"":e,t),t);import{w as f,j as ce,k as he}from"./singletons.a176ba40.js";import{I as a}from"./index.e9b9921d.js";const j={INT:/^-?[0-9]+$/,FLOAT:/^-?[0-9]+\.[0-9]+$/,SPACE:/^( +)/},L=n=>{n=n.replace(/\r\n/g,`
`).replace(/\n *\n/g,`
`).replace(/ +\n/g,`
`);const e=new m,t=0,s=n.split(`
`);return e.parse(s,t,0),e},D=n=>{const e=n.match(j.SPACE);return e?e[1].length:0};class me{constructor(e){o(this,"data");o(this,"set",e=>this.data=e);o(this,"get",()=>this.data);this.data=e}}class m{constructor(e){o(this,"key");o(this,"data",{});o(this,"put",(e,t)=>{this.data[e]=t});o(this,"has",e=>this.data[e]!==void 0);o(this,"get",(e,t,s)=>((this.data[e]=="[]"||this.data[e]==" []")&&(this.data[e]=JSON.parse(this.data[e].trim())),this.has(e)?s?s(this.data[e]):this.data[e]:t));o(this,"getKeys",()=>Object.keys(this.data));o(this,"remove",e=>{delete this.data[e]});o(this,"parse",(e,t,s,i)=>{for(i&&(this.key=i);t<e.length&&D(e[t])>=s;){for(;t<e.length&&(D(e[t])!=s||e[t].replace(/ /g,"").charAt(0)=="#"||e[t].indexOf(":")==-1);)t++;if(t==e.length)return t;let r=e[t].substring(s,e[t].indexOf(":"));if(r==="loaded"){t++;continue}if(r.match(/^["'].*["']$/)&&(r=r.substring(1,r.length-1)),!this.key&&!i&&(this.key=r),e[t].search(/: +\{\}/)!=-1&&e[t].length>=4)this.data[r]=new m(r);else if(t<e.length-1&&e[t+1].charAt(s)=="-"&&e[t+1].charAt(s+1)==" "&&D(e[t+1])==s){const l=[];for(;++t<e.length&&e[t].charAt(s)=="-";){let c=e[t].substring(s+2);(c.charAt(0)=="'"||c.charAt(0)=='"')&&(c=c.substring(1,c.length-1).replace(/\\(['"])/,h=>h.replace("\\",""))),l.push(c)}this.data[r]=l,t--}else if(t<e.length-1&&D(e[t+1])>s){t++;const l=D(e[t]),c=new m;t=c.parse(e,t,l,r)-1,this.data[r]=c}else{let l=e[t].substring(e[t].indexOf(":")+2);l.charAt(0)=="'"||l.charAt(0)=='"'?l=l.substring(1,l.length-1):isNaN(l)||(j.INT.test(l)?l=parseInt(l):l=parseFloat(l)),typeof l=="string"&&(l.toLowerCase()=="false"?l=!1:l.toLowerCase()=="true"?l=!0:l=l.replace(/\\(['"])/,c=>c.replace("\\",""))),this.data[r]=l}do t++;while(t<e.length&&e[t].replace(/ /g,"").charAt(0)=="#")}return Object.keys(this.data).length==1&&this.key&&this.data[this.key]instanceof m&&(this.data=this.data[this.key].data),t});o(this,"toString",()=>this.toYaml(this.key||this.data.name?"'"+(this.key||this.data.name)+"'":void 0,this.data));o(this,"toYaml",(e,t,s=new me("a"),i="")=>{if(t instanceof m)return t.toYaml("'"+(e??t.key)+"'",t.data,s,i);let r="";e&&(r+=i+e+`:
`,i+="  ");for(const l of Object.keys(t)){const c=t[l];let h="";if(c!=null){if(c instanceof Object)if(Object.keys(c).includes("toYaml"))if(c instanceof m){r+=c.toYaml("'"+l+"'",c.data,s,i);continue}else h=c.toYaml(i);else c instanceof Array&&(h=this.convertArray(l,s,i,c));else{const u=JSON.stringify(c);h=i+l+": "+u+`
`}h&&(r+=h.replaceAll(/(\\)?'/g,"\\'").replaceAll(/((\\)?")/g,u=>u.length==1?"'":u).replaceAll(/\\"/g,'"').replace(/\\\\/g,"\\"))}}return r});o(this,"nextChar",e=>/z+/.test(e)?e.replaceAll(/z/g,"a")+"a":e.substring(0,e.length-1)+String.fromCharCode(e.charCodeAt(e.length-1)+1));this.key=e}convertArray(e,t,s,i){if(e!="attributes"){let r=s+e+":";if(["string","number"].includes(typeof i[0]))i.length>0?(r+=`
`,i.forEach(l=>r+=s+"- "+JSON.stringify(l)+`
`)):r+=` []
`;else if(e==="components"||e==="children")if(i.length==0)r+=` {}
`;else return r+=`
`,i.forEach(l=>{const c=t.get();t.set(this.nextChar(t.get())),r+=this.toYaml(l.name+"-"+c,l.toYamlObj(),t,s+"  ")}),r.replaceAll(/'/g,'"');else r+=` []
`;return r}else return this.toYaml(e,i,t,s)}}class g{constructor(e,t,s){o(this,"name");o(this,"base");o(this,"scale");o(this,"toYaml",(e="")=>e+this.name.toLowerCase()+"-base: "+this.base+`
`+e+this.name.toLowerCase()+"-scale: "+this.scale+`
`);this.name=e,this.base=t,this.scale=s}}class w{constructor(e){o(this,"key",{});o(this,"isFolder",!0);o(this,"open",!1);o(this,"name","Folder");o(this,"data",[]);o(this,"parent");o(this,"updateParent",e=>{this.parent=e});o(this,"add",e=>{this.data.includes(e)||(e instanceof w&&(B(e,this.data),ze(e),e.parent=this),this.data.push(e),this.sort())});o(this,"remove",e=>{this.data=this.data.filter(t=>t!=e),this.sort()});o(this,"sort",()=>{this.data=this.data.sort((e,t)=>{let s=0;return e instanceof w&&(t instanceof w||(s=-100)),e.name.localeCompare(t.name)+s}),J()});o(this,"createFolder",()=>{const e=new w;B(e,this.data),this.data.push(e),this.sort(),e.updateParent(this)});o(this,"deleteFolder",e=>{this.data=this.data.filter(t=>t!=e)});o(this,"contains",e=>{if(this.data.includes(e))return!0;for(const t of this.data.filter(s=>s instanceof w))if(t.contains(e))return!0;return!1});o(this,"getContainingFolder",e=>{if(this.data.includes(e))return this;for(const t of this.data.filter(s=>s instanceof w)){if(t.data.includes(e))return t;{const s=t.getContainingFolder(e);if(!s)continue;return s}}});e&&(this.data=e,e.forEach(t=>{t instanceof w&&t.isFolder&&t.updateParent(this)}))}}const V=n=>n.replace("_"," ").toLowerCase().replace(/^(.)|\s(.)/g,e=>e.toUpperCase()),_=n=>(n=n.replace("_"," "),n.substring(0,1).toUpperCase()+n.substring(1).toLowerCase()),b=n=>n.sort((e,t)=>e.name.localeCompare(t.name)),ue=(n,e)=>{let t=e;localStorage.getItem(n)===null&&localStorage.setItem(n,JSON.stringify(e)),t=JSON.parse(localStorage.getItem(n));const{subscribe:s,set:i,update:r}=f(t);return{subscribe:s,set:l=>(localStorage.setItem(n,JSON.stringify(l)),i(l)),update:r}};class ee{}o(ee,"new",()=>{throw new Error("'new' method not implemented")});class pe extends ee{constructor(t,s){super();o(this,"type");o(this,"name");o(this,"description");o(this,"components",f([]));o(this,"data",[]);o(this,"preview",[]);o(this,"isParent",!0);o(this,"isDeprecated",!1);o(this,"id",{});o(this,"_defaultOpen",!1);o(this,"parent");o(this,"setComponents",t=>{t.forEach(s=>s.parent=this),this.components.set([...t])});o(this,"contains",t=>{const s=a(this.components);if(s.includes(t))return!0;for(const i of s)if(i.contains(t))return!0;return!1});o(this,"addComponent",(t,s=-1)=>{const i=a(this.components);s==-1?i.push(t):i.splice(s,0,t),this.setComponents(i)});o(this,"removeComponent",t=>{const s=a(this.components);if(s.includes(t)){s.splice(s.indexOf(t),1),t.parent=void 0,this.setComponents(s);return}for(const i of s)i.contains(t)&&i.removeComponent(t)});o(this,"defaultOpen",()=>(this._defaultOpen=!0,this));this.type=t,this.name=s.name,this.description=s.description??"",this.setComponents(s.components||[]),this.data=s.data||[],this.preview=s.preview||[]}toYamlObj(){const t=new m(this.name);t.put("type",this.type);const s=new m("preview");return this.preview.forEach(i=>{const r=i.getData();Object.keys(r).forEach(l=>s.put(l,r[l]))}),s.getKeys().length>0&&t.put("preview",s),t}deserialize(t){const s=t.get("preview");s&&this.preview.forEach(i=>i.deserialize(s))}}const p=class p{};o(p,"triggers",f({})),o(p,"targets",f({})),o(p,"conditions",f({})),o(p,"mechanics",f({})),o(p,"initialized",f(!1)),o(p,"getTriggerByName",e=>{var t;return(t=Object.values(a(p.triggers)).find(s=>s.name.toLowerCase()===e.toLowerCase()))==null?void 0:t.component}),o(p,"getTargetByName",e=>{var t;return(t=Object.values(a(p.targets)).find(s=>s.name.toLowerCase()===e.toLowerCase()))==null?void 0:t.component}),o(p,"getConditionByName",e=>{var t;return(t=Object.values(a(p.conditions)).find(s=>s.name.toLowerCase()===e.toLowerCase()))==null?void 0:t.component}),o(p,"getMechanicByName",e=>{var t;return(t=Object.values(a(p.mechanics)).find(s=>s.name.toLowerCase()===e.toLowerCase()))==null?void 0:t.component}),o(p,"deserializeComponents",e=>{if(!e||!(e instanceof m))return[];const t=[],s=e.getKeys();for(const i of s){let r;const l=e.get(i),c=l.get("type");if(c==="trigger"){const h=p.getTriggerByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="target"){const h=p.getTargetByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="condition"){const h=p.getConditionByName(i.split("-")[0]);h&&(r=h.new())}else if(c==="mechanic"){const h=p.getMechanicByName(i.split("-")[0]);h&&(r=h.new())}r&&(r.deserialize(l),t.push(r))}return t});let q=p;const N=class N extends pe{constructor(t,s=!1){super("trigger",t);o(this,"mana",!1);o(this,"cooldown",!1);o(this,"clone",()=>new N({name:this.name,components:[...a(this.components)],mana:this.mana,cooldown:this.cooldown,data:[...this.data]}));this.mana=t.mana||!1,this.cooldown=t.cooldown||!1,super.isDeprecated=s}toYamlObj(){const t=super.toYamlObj(),s=this.getData();s.getKeys().length>0&&t.put("data",s);const i=a(this.components);return i.length>0&&t.put("children",i),t}getData(){const t=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.filter(s=>s.meetsRequirements(this)).forEach(s=>{const i=s.getData();Object.keys(i).forEach(r=>t.put(r,i[r]))}),t}getRawData(){const t=new m("data");return this.name!="Cast"&&this.name!="Initialize"&&this.name!="Cleanup"&&(t.put("mana",this.mana),t.put("cooldown",this.cooldown)),this.data.forEach(s=>{const i=s.getData();Object.keys(i).forEach(r=>t.put(r,i[r]))}),t}deserialize(t){super.deserialize(t);const s=t.get("data");s&&(this.mana=s.get("mana",!1),this.cooldown=s.get("cooldown",!1),this.data.forEach(i=>i.deserialize(s))),this.setComponents(t.get("children",[],i=>q.deserializeComponents(i)))}};o(N,"new",()=>new N({name:"null"}));let A=N;class S{constructor(e){o(this,"isSkill",!0);o(this,"key",{});o(this,"name");o(this,"type","Dynamic");o(this,"maxLevel",5);o(this,"skillReq");o(this,"skillReqLevel",0);o(this,"permission",!1);o(this,"levelReq",new g("level",1,0));o(this,"cost",new g("cost",1,0));o(this,"cooldown",new g("cooldown",0,0));o(this,"cooldownMessage",!0);o(this,"mana",new g("mana",0,0));o(this,"minSpent",new g("points-spent-req",0,0));o(this,"castMessage","&6{player} &2has cast &6{skill}");o(this,"combo","");o(this,"indicator","2D");o(this,"icon",{material:"Pumpkin",customModelData:0,lore:["&d{name} &7({level}/{max})","&2Type: &6{type}","","{req:level}Level: {attr:level}","{req:cost}Cost: {attr:cost}","","&2Mana: {attr:mana}","&2Cooldown: {attr:cooldown}"]});o(this,"incompatible",[]);o(this,"triggers",[]);o(this,"skillReqStr","");o(this,"incompStr",[]);o(this,"addComponent",e=>{var t;if(e instanceof A){this.triggers=[...this.triggers,e];return}this.triggers.length===0&&this.triggers.push((t=q.getTriggerByName("cast"))==null?void 0:t.new()),this.triggers[0].addComponent(e),this.triggers=[...this.triggers]});o(this,"removeComponent",e=>{if(e instanceof A&&this.triggers.includes(e)){this.triggers.splice(this.triggers.indexOf(e),1);return}for(const t of this.triggers)t.contains(e)&&t.removeComponent(e);this.triggers=[...this.triggers]});o(this,"serializeYaml",()=>{var i;const e=new m(this.name),t=new m;t.put("name",this.name),t.put("type",this.type),t.put("max-level",this.maxLevel),t.put("skill-req",(i=this.skillReq)==null?void 0:i.name),t.put("skill-req-lvl",this.skillReqLevel),t.put("needs-permission",this.permission),t.put("cooldown-message",this.cooldownMessage),t.put("msg",this.castMessage),t.put("combo",this.combo),t.put("indicator",this.indicator),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore);const s=new m("attributes");return s.put("level",this.levelReq),s.put("cost",this.cost),s.put("cooldown",this.cooldown),s.put("mana",this.mana),s.put("points-spent-req",this.minSpent),t.put("attributes",s),t.put("incompatible",this.incompatible.map(r=>r.name)),t.put("components",this.triggers),e.data=t.data,e});o(this,"load",e=>{this.name=e.get("name",this.name),this.type=e.get("type",this.type),this.maxLevel=e.get("max-level",this.maxLevel),this.skillReqStr=e.get("skill-req",this.skillReqStr),this.skillReqLevel=e.get("skill-req-lvl",this.skillReqLevel),this.permission=e.get("needs-permission",this.permission),this.cooldownMessage=e.get("cooldown-message",this.cooldownMessage),this.castMessage=e.get("msg",this.castMessage),this.combo=e.get("combo",this.combo),this.indicator=e.get("indicator",this.indicator);const t=e.get("attributes");this.levelReq=new g("level",t.get("level-base"),t.get("level-scale")),this.cost=new g("cost",t.get("cost-base"),t.get("cost-scale")),this.cooldown=new g("cooldown",t.get("cooldown-base"),t.get("cooldown-scale")),this.mana=new g("mana",t.get("mana-base"),t.get("mana-scale")),this.minSpent=new g("points-spent-req",t.get("points-spent-req-base"),t.get("points-spent-req-scale")),this.icon.material=e.get("icon",this.icon.material,_),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.incompStr=e.get("incompatible",this.incompStr);let s;s=q.initialized.subscribe(i=>{i&&(this.triggers=e.get("components",this.triggers,r=>q.deserializeComponents(r)),s&&s())})});o(this,"postLoad",()=>{this.skillReq=y(this.skillReqStr),this.incompatible=this.incompStr.map(e=>y(e)).filter(e=>!!e)});this.name=e?e.name:"Skill",e!=null&&e.type&&(this.type=e.type),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.skillReq&&(this.skillReq=e.skillReq),e!=null&&e.skillReqLevel&&(this.skillReqLevel=e.skillReqLevel),e!=null&&e.permission&&(this.permission=e.permission),e!=null&&e.levelReq&&(this.levelReq=e.levelReq),e!=null&&e.cost&&(this.cost=e.cost),e!=null&&e.cooldown&&(this.cooldown=e.cooldown),e!=null&&e.cooldownMessage&&(this.cooldownMessage=e.cooldownMessage),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.minSpent&&(this.minSpent=e.minSpent),e!=null&&e.castMessage&&(this.castMessage=e.castMessage),e!=null&&e.combo&&(this.combo=e.combo),e!=null&&e.indicator&&(this.indicator=e.indicator),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.incompatible&&(this.incompatible=e.incompatible),e!=null&&e.triggers&&(this.triggers=e.triggers)}}const R=ce("goto"),fe=n=>{const e=[],t=L(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new S({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new S({name:i}),s.load(t.data[i]),e.push(s));return e},te=(n,e,t,s,i)=>{let r=e;{const u=localStorage.getItem(n);u&&(r=t(u),i&&i(r))}const{subscribe:l,set:c,update:h}=f(r);return{subscribe:l,set:u=>(s&&(u=s(u)),c(u)),update:h}},d=te("skillData",[],n=>b(fe(n)),n=>(se(n),b(n))),y=n=>{for(const e of a(d))if(e.name==n)return e},C=te("skillFolders",[],n=>JSON.parse(n,(t,s)=>{if(/\d+/.test(t)){if(typeof s=="string")return y(s);const i=new w(s.data);return i.name=s.name,i}return s}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof S||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("skillFolders",e),b(n)}),T=n=>!!y(n),W=n=>{const e=a(d),t=new S({name:n||"Skill "+(e.length+1)});return e.push(t),d.set(e),t},xe=n=>{const e=a(d);let t=n.name+" (Copy)",s=1;for(;T(t);)t=n.name+" (Copy "+s+")",s++;const i=new S;return i.load(L(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),d.set(e),i},Ae=n=>{const e=a(C);e.includes(n)||(B(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),C.set(e))},ge=n=>{const e=a(C).filter(t=>t!=n);C.set(e)},we=n=>{const e=a(d).filter(s=>s!=n),t=a(z);d.set(e),t instanceof S&&(e.length===0?R("/"):e.find(s=>s===a(z))||R(`/skill/${e[0].name}`))},M=()=>d.set(b(a(d))),de=()=>{C.set(b(a(C))),M()},G=n=>{const e=L(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=T(s)?y(s):W(s),t.load(e),M();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof m&&!T(s)&&(t=T(s)?y(s):W(s),t.load(e.data[s]));M()},ke=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&G(e)},U=f(!1);let $;const se=n=>{a(U)&&$&&clearTimeout($),U.set(!0),$=setTimeout(()=>{const e=n||a(d),t=new m;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("skillData",t.toString()),U.set(!1)},2e3)};a(d).forEach(n=>n.postLoad());class v{constructor(e){o(this,"isClass",!0);o(this,"key",{});o(this,"name");o(this,"prefix","");o(this,"group","class");o(this,"manaName","&2Mana");o(this,"maxLevel",40);o(this,"parentStr","");o(this,"parent");o(this,"permission",!1);o(this,"expSources",273);o(this,"manaRegen",1);o(this,"health",new g("health",20,1));o(this,"mana",new g("mana",20,1));o(this,"attributes",[]);o(this,"skillTree","Requirement");o(this,"skills",[]);o(this,"icon",{material:"Pumpkin",customModelData:0});o(this,"unusableItems",[]);o(this,"actionBar","");o(this,"updateAttributes",e=>{const t=[];this.attributes=this.attributes.filter(s=>e!=null&&e.includes(s.name)?(t.push(s.name),!0):!1),e=e.filter(s=>!t.includes(s));for(const s of e)this.attributes.push(new g(s,0,0))});o(this,"serializeYaml",()=>{var s;const e=new m(this.name),t=new m;return t.put("name",this.name),t.put("action-bar",this.actionBar),t.put("prefix",this.prefix),t.put("group",this.group),t.put("mana",this.manaName),t.put("max-level",this.maxLevel),t.put("parent",((s=this.parent)==null?void 0:s.name)||""),t.put("needs-permission",this.permission),t.put("attributes",[this.health,this.mana,...this.attributes]),t.put("mana-regen",this.manaRegen),t.put("skill-tree",this.skillTree.toUpperCase().replace(/ /g,"_")),t.put("blacklist",this.unusableItems),t.put("skills",this.skills.map(i=>i.name)),t.put("icon",this.icon.material),t.put("icon-data",this.icon.customModelData),t.put("icon-lore",this.icon.lore),t.put("exp-source",this.expSources),e.data=t.data,e});o(this,"updateParent",e=>{this.parentStr&&(this.parent=e.find(t=>t.name===this.parentStr))});o(this,"load",e=>{this.name=e.get("name",this.name),this.actionBar=e.get("action-bar",this.actionBar),this.prefix=e.get("prefix",this.prefix),this.group=e.get("group",this.group),this.maxLevel=e.get("max-level",this.maxLevel),this.parentStr=e.get("parent",this.parentStr),this.permission=e.get("needs-permission",this.permission),this.attributes=e.get("attributes",this.attributes,t=>{const s=[],i=t.get("health-base",20),r=t.get("health-scale",1),l=t.get("mana-base",20),c=t.get("mana-scale",1);this.health=new g("health",i,r),this.mana=new g("mana",l,c),t.remove("health-base"),t.remove("health-scale"),t.remove("mana-base"),t.remove("mana-scale");const h={};return Object.keys(t.data).forEach(u=>{const P=u.split("-"),I=V(P[0]);h[I]||(h[I]=new g(I,0,0));const Q=h[I];P[1]=="base"&&(Q.base=Number.parseFloat(t.data[u])),P[1]=="scale"&&(Q.scale=Number.parseFloat(t.data[u]))}),s.push(...Object.values(h)),s}),this.manaRegen=e.get("mana-regen",this.manaRegen),this.skillTree=e.get("tree",this.skillTree,V),this.unusableItems=e.get("blacklist",this.unusableItems),this.skills=e.get("skills",this.skills,t=>t.map(s=>y(s)).filter(s=>!!s)),this.icon.material=e.get("icon",this.icon.material,_),this.icon.customModelData=e.get("icon-data",this.icon.customModelData),this.icon.lore=e.get("icon-lore",this.icon.lore),this.expSources=e.get("exp-source",this.expSources)});this.name=e?e.name:"Class",this.prefix=e!=null&&e.prefix?e.prefix:"&6"+this.name,e!=null&&e.group&&(this.group=e.group),e!=null&&e.manaName&&(this.manaName=e.manaName),e!=null&&e.maxLevel&&(this.maxLevel=e.maxLevel),e!=null&&e.parent&&(this.parent=e.parent),e!=null&&e.permission&&(this.permission=e.permission),e!=null&&e.expSources&&(this.expSources=e.expSources),e!=null&&e.health&&(this.health=e.health),e!=null&&e.mana&&(this.mana=e.mana),e!=null&&e.manaRegen&&(this.manaRegen=e.manaRegen),e!=null&&e.attributes&&(this.attributes=e.attributes),e!=null&&e.skillTree&&(this.skillTree=e.skillTree),e!=null&&e.skills&&(this.skills=e.skills),e!=null&&e.icon&&(this.icon=e.icon),e!=null&&e.unusableItems&&(this.unusableItems=e.unusableItems),e!=null&&e.actionBar&&(this.actionBar=e.actionBar)}}const be=n=>{const e=[],t=L(n);let s;if(t.key&&!t.data[t.key]){const i=t.key;return i==="loaded"||(s=new v({name:i}),s.load(t),e.push(s)),e}for(const i in t.data)i!="loaded"&&t.data[i]instanceof m&&(s=new v({name:i}),s.load(t.data[i]),e.push(s));return e},ne=(n,e,t,s,i)=>{let r=e;{const u=localStorage.getItem(n);u&&(r=t(u),i&&i(r))}const{subscribe:l,set:c,update:h}=f(r);return{subscribe:l,set:u=>(s&&(u=s(u)),c(u)),update:h}},k=ne("classData",[],n=>b(be(n)),n=>(ie(n),n.forEach(e=>e.updateParent(n)),b(n)),n=>n.forEach(e=>e.updateParent(n))),E=n=>{for(const e of a(k))if(e.name==n)return e},O=ne("classFolders",[],n=>JSON.parse(n,(t,s)=>{if(s){if(/\d+/.test(t)){if(typeof s=="string")return E(s);const i=new w(s.data);return i.name=s.name,i}return s}}),n=>{const e=JSON.stringify(n,(t,s)=>s instanceof v||s instanceof S?s.name:t==="parent"?void 0:s);return localStorage.setItem("classFolders",e),b(n)}),X=n=>a(k).forEach(e=>e.updateAttributes(n)),x=n=>!!E(n),Z=n=>{const e=a(k),t=new v({name:n||"Class "+(e.length+1)});return e.push(t),k.set(e),t},Re=n=>{const e=a(k);let t=n.name+" (Copy)",s=1;for(;x(t);)t=n.name+" (Copy "+s+")",s++;const i=new v;return i.load(L(n.serializeYaml().toString()).get(n.name)),i.name=t,e.push(i),k.set(e),i},Me=n=>{const e=a(O);e.includes(n)||(B(n,e),e.push(n),e.sort((t,s)=>t.name.localeCompare(s.name)),O.set(e))},Se=n=>{const e=a(O).filter(t=>t!=n);O.set(e)},Ce=n=>{const e=a(k).filter(s=>s!=n),t=a(z);k.set(e),t instanceof v&&(e.length===0?R("/"):e.find(s=>s===a(z))||R(`/class/${e[0].name}/edit`))},Y=()=>k.set(b(a(k))),ve=()=>{O.set(b(a(O))),Y()},H=n=>{const e=L(n);let t;if(e.key&&!e.data[e.key]){const s=e.key;t=x(s)?E(s):Z(s),t.load(e),Y();return}for(const s in e.data)s!="loaded"&&e.data[s]instanceof m&&!x(s)&&(t=x(s)?E(s):Z(s),t.load(e.data[s]));Y()},Oe=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&H(e)},ie=n=>{const e=n||a(k),t=new m;t.put("loaded",!1),e.forEach(s=>t.put(s.name,s.serializeYaml())),localStorage.setItem("classData",t.toString())},ye=(()=>{let n=["vitality","spirit","intelligence","dexterity","strength"];{const i=localStorage.getItem("attribs");i&&(n=i.split(","),X(n))}const{subscribe:e,set:t,update:s}=f(n);return{subscribe:e,set:i=>(localStorage.setItem("attribs",i.join(",")),X(i),t(i)),update:s}})(),oe=n=>{const e=L(n),t=Object.keys(e.data);ye.set(t)},z=f(void 0),Le=he(z,n=>n instanceof v?"class":"skill"),Ee=f(),Ye=f(),F=ue("sidebarOpen",!0),Be=f(!0),re=f(!0),qe=f(!1),Je=()=>{a(F)&&(a(Le)=="class"?Y():M(),J())},Pe=()=>F.set(!a(F)),Ue=()=>F.set(!1),$e=n=>qe.set(n),B=(n,e)=>{const t=n.name;let s=1;for(;e.filter(i=>i instanceof w&&i.name==n.name).length>=1;)n.name=t+" ("+s+++")"},Ke=n=>{n.parent?(n.parent.deleteFolder(n),J()):a(re)?Se(n):ge(n)},Ge=n=>{var e;n&&((e=De(n))==null||e.remove(n),n instanceof v?Ce(n):n instanceof S&&we(n),J())},J=()=>{a(F)&&(a(re)?ve():de())},He=()=>{ie(),se()},ze=n=>{const e=a(O),t=a(C);e.includes(n)&&O.set(e.filter(s=>s!=n)),t.includes(n)&&C.set(t.filter(s=>s!=n))},De=n=>{if(n instanceof w)return n.parent;const e=n instanceof v?a(O):a(C);for(const t of e){const s=t.getContainingFolder(n);if(s)return s}},Ne=n=>{var t;const e=(t=n.target)==null?void 0:t.result;e&&(e.indexOf("global:")>=0?oe(e):e.indexOf("components:")>=0||e.indexOf("group:")==-1&&e.indexOf("combo:")==-1&&e.indexOf("skills:")==-1?G(e):H(e),document.activeElement.blur())},Qe=n=>{n.indexOf("global:")>=0?oe(n):n.indexOf("components:")>=0||n.indexOf("group:")==-1&&n.indexOf("combo:")==-1&&n.indexOf("skills:")==-1?G(n.replace(`loaded: false
`,"")):H(n.replace(`loaded: false
`,""))},Ve=n=>{const e=new FileReader;n.name.indexOf("skills")==0?e.onload=ke:n.name.indexOf("classes")==0?e.onload=Oe:e.onload=Ne,e.readAsText(n)},We=n=>{const e=n||a(z);e&&K(e.name+".yml",e.serializeYaml().toString())},Xe=()=>{const n=a(d);n.sort((i,r)=>i.name>r.name?1:i.name<r.name?-1:0);const e=a(k);e.sort((i,r)=>i.name>r.name?1:i.name<r.name?-1:0);const t=new m;t.put("loaded",!1);for(const i of n)t.put(i.name,i.serializeYaml());const s=new m;s.put("loaded",!1);for(const i of e)s.put(i.name,i.serializeYaml());K("skills.yml",t.toString()),K("classes.yml",s.toString())},K=(n,e)=>{const t=new Blob([e],{type:"text/plain;charset=utf-8"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=n,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s)};export{Ke as A,ze as B,O as C,C as D,Z as E,W as F,Ue as G,U as H,Xe as I,F as J,qe as K,Ye as L,L as M,pe as N,ye as O,g as P,Je as Q,q as R,He as S,V as T,ue as U,m as Y,Ve as a,Le as b,z as c,k as d,v as e,E as f,R as g,d as h,S as i,y as j,A as k,Qe as l,De as m,Be as n,Ee as o,w as p,re as q,Me as r,$e as s,Pe as t,J as u,Ae as v,Re as w,xe as x,We as y,Ge as z};
